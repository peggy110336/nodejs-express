<<!DOCTYPE html>
<html>
	<head>
		<title>Bootstrap Pratice</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		 <!-- Bootstrap -->
	    <link rel="stylesheet" href="css/bootstrap.min.css">
	    <link rel="stylesheet" href="css/style.css">
	</head>

	<script id='vcardTemplate' type='text/x-jquery-tmpl'>
		<div class="col-xs-12 col-md-6">
          <div class="alert alert-danger">
		    <h2>${name}</h2>
		    <img class='img-circle' src='upload/${nickname}.jpg' data-toggle='photo' width='96' height='96' data-nickname="${nickname}" />
	        <span class="label label-warning">${tel}</span>
	        <div class="hide-admin" data-admin='${nickname}'>
		        <p><input type='file' class="btn btn-large btn-info" name='filename' id="${nickname}">
	            <p><button class="btn btn-large btn-info" data-toggle='upload-photo' data-nickname="${nickname}">Upload Photo</button></p>
	        </div>
	      </div>
	    </div>
	</script>

	<body>
	    <div class="container">
		   <h1>Cards</h1>
		   <div class="row">
		     <div id="userList"></div>
		   </div>
		</div> 

		 <script src="js/jquery.js"></script>
		 <script src="js/bootstrap.min.js"></script>
		 <script src="js/jquery.tmpl.min.js" type="text/javascript"></script>

		 <script>
		  $(document).ready(function () {
		    $.ajax({
		      url: '/1/user',
		      type: 'GET',
		      datatype: 'json',
		      success: function (data, textStatus, jqXHR) {
		        $('#vcardTemplate').tmpl(data).appendTo('#userList');
		      },
		      complete: function (data, textStatus, jqXHR) {
		      	$("img[data-toggle='photo']").each(function(index) {
		             var me = $(this);

		             me.on('click', function() {
		               var nickname = me.data('nickname');
		               var name = "div[data-admin='" + nickname + "'";

		               if ($(name).hasClass('hide-admin')) {
		                 $(name).removeClass('hide-admin');
		               } else {
		                 $(name).addClass('hide-admin');
		               }
		             });
	            });
 
          	    $("button[data-toggle='upload-photo']").on('click', function() {
            		var nickname = $(this).data('nickname');
            		var data = new FormData();
            		data.append('file', $('#' + nickname)[0].files[0]);

            $.ajax({
               url: '/1/user/' + nickname + '/photo',
               data: data,
               cache: false,
               contentType: false,
               processData: false,
               type: 'POST',
               success: function() {
               	$("img[data-img='" + nickname + "'").prop('src', '/upload/' + nickname + '.jpg');
                console.log('upload success');
               }
            });
          });          
        }
      });
    });
    </script>
  </body>
</html>